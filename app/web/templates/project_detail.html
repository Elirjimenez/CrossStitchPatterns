{% extends "base.html" %}

{% block title %}{{ name }} â€“ Cross-Stitch Pattern Generator{% endblock %}

{% block content %}
<div class="py-10">

  <!-- Breadcrumb -->
  <nav class="text-sm text-gray-400 mb-6">
    <a href="/projects" class="hover:text-indigo-600 transition-colors">Projects</a>
    <span class="mx-2">/</span>
    <span class="text-gray-600">{{ name }}</span>
  </nav>

  <!-- Header -->
  <div class="flex items-start justify-between mb-8">
    <div>
      <h2 class="text-3xl font-bold text-gray-800 mb-2">{{ name }}</h2>
      <p class="text-xs text-gray-400 font-mono">{{ id }}</p>
    </div>
    <div class="flex items-center gap-3">
      {% if status == "completed" %}
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Completed</span>
      {% elif status == "in_progress" %}
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">In Progress</span>
      {% elif status == "failed" %}
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">Failed</span>
      {% else %}
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">Created</span>
      {% endif %}

      <button
        hx-delete="/hx/projects/{{ project_id }}"
        hx-confirm="Delete project '{{ name }}'? This cannot be undone."
        {% if status == "in_progress" %}disabled title="Cannot delete while processing"{% endif %}
        class="inline-flex items-center px-3 py-1 rounded text-sm font-medium
               {% if status == 'in_progress' %}bg-gray-200 text-gray-400 cursor-not-allowed{% else %}bg-red-100 text-red-700 hover:bg-red-200 transition-colors{% endif %}">
        Delete
      </button>
    </div>
  </div>

  <p class="text-sm text-gray-500 mb-10">Created on {{ created_at }}</p>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">

    <!-- A: Source Image -->
    {% with project_id=project_id, source_image_ref=source_image_ref %}
      {% include "partials/source_image_card.html" %}
    {% endwith %}

    <!-- B: Actions (lazy-loaded so it refreshes after image upload) -->
    <div id="project-actions"
         hx-get="/hx/projects/{{ project_id }}/actions"
         hx-trigger="load, actions:refresh from:body"
         hx-swap="outerHTML"></div>

    <!-- C: Pattern / Results -->
    {% with project_id=project_id %}
      {% include "partials/pattern_results_card.html" %}
    {% endwith %}

  </div>

  <!-- Back link -->
  <div class="mt-10">
    <a href="/projects" class="text-sm text-indigo-600 hover:text-indigo-800 transition-colors">
      &larr; Back to Projects
    </a>
  </div>

</div>
{% endblock %}
