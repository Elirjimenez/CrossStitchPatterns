{% set pid = project_id or id %}
<div id="source-image-card" class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
  <h3 class="text-base font-semibold text-gray-700 mb-3">Source Image</h3>

  <!-- Current state -->
  {% if source_image_ref %}
    <img
      src="/api/projects/files/{{ source_image_ref }}"
      alt="Source image preview"
      onerror="this.style.display='none'"
      class="max-h-40 w-full object-contain rounded-lg border border-gray-200 mb-3" />
    <p class="text-sm text-green-700 mb-1">&#10003; Image uploaded</p>
    <p class="text-xs text-gray-400 font-mono break-all mb-4">{{ source_image_ref }}</p>
  {% else %}
    <p class="text-sm text-gray-400 mb-4">No image uploaded yet.</p>
  {% endif %}

  <!-- Error alert -->
  {% if error %}
    <div class="flex items-start gap-2 bg-red-50 border border-red-200 text-red-700 rounded-lg px-3 py-2 text-sm mb-4">
      <span>&#9888;</span>
      <span>{{ error }}</span>
    </div>
  {% endif %}

  <!-- Upload form -->
  <form
    hx-post="/hx/projects/{{ pid }}/source-image"
    hx-target="#source-image-card"
    hx-swap="outerHTML"
    hx-encoding="multipart/form-data"
    hx-indicator="#upload-indicator-{{ pid }}">
    <div class="flex gap-2 items-center">
      <input
        type="file"
        name="file"
        accept="image/png,image/jpeg,image/webp,image/gif"
        class="flex-1 text-sm text-gray-500 file:mr-3 file:py-1.5 file:px-3 file:rounded-lg file:border file:border-gray-300 file:text-sm file:bg-white file:text-gray-600 hover:file:bg-gray-50" />
      <button
        type="submit"
        class="bg-indigo-600 text-white px-4 py-1.5 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors">
        Upload
      </button>
    </div>
    <p id="upload-indicator-{{ pid }}" class="htmx-indicator text-xs text-gray-400 mt-2">
      Uploading&hellip;
    </p>
  </form>
</div>
